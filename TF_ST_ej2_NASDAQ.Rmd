---
title: "Series Temporales - Trabajo Final"
author: "Esteban Schab - Anabella De Battista"
date: "!r Sys.Date()"
output:
  html_document:
    toc: yes
    df_print: paged
  pdf_document:
    toc: yes
    fig_width: 70
    fig_height: 60
    fig_caption: yes
    df_print: default
    keep_tex: yes
fontsize: 11pt
geometry: margin=1in
---

```{r  knitr-options, include=FALSE}
knitr::opts_chunk$set(fig.path='RmdFigs/', warning=FALSE, message=FALSE, out.width = '90%')
```


```{r load-packages, include=FALSE}
library('tidyverse')
library('knitr')    
library('kableExtra')
library('plotly')    
library('scales')    
library('MASS')
library('dplyr')
library('rgl')
library('rJava')
library('xlsx')
library('xlsxjars')
library('readxl')
library('rugarch')
library('fdth')
library('psych')
library('xtable')
library('stargazer')
```


```{r read-file}
archivo <- './data/Datos-dax-nasdaq-originales.xlsx'
dax_nasdaq_dow <- read_excel(archivo, col_names = TRUE)
names(dax_nasdaq_dow)
```

```{r rename-cols}
names(dax_nasdaq_dow) <- c("Fecha", "DAX", "NASDAQ")
names(dax_nasdaq_dow)
```

```{r}
summary(dax_nasdaq_dow)
```


```{r calc-rend-log}
indice_dax <- as.numeric(unlist(dax_nasdaq_dow[,"DAX"]))
rend_log_dax <- diff(log(indice_dax))
#agrego un 0 al principio para poder agregar la columna de rendimientos al dataframe original 
rend_log_dax <- c(0, rend_log_dax)

indice_nasdaq <- as.numeric(unlist(dax_nasdaq_dow[,"NASDAQ"]))
rend_log_nasdaq <- diff(log(indice_nasdaq))
#agrego un NA al principio para poder agregar la columna de rendimientos al dataframe original 
rend_log_nasdaq <- c(0, rend_log_nasdaq)


```

```{r new-dataframe}
df_dax_nasdaq_dow <- cbind(dax_nasdaq_dow,
                           rdto_dax=rend_log_dax, 
                           rdto_nasdaq=rend_log_nasdaq
                           )

# reordenamos columnas
df_dax_nasdaq_dow <- df_dax_nasdaq_dow[, c(1, 2, 4, 3, 5)]
head(df_dax_nasdaq_dow)
```

Estadísticas principales del dataset.

```{r}
summary(df_dax_nasdaq_dow)
```

Estadísticas más completas del rendimiento del índice NASDAQ


```{r EDA_DAX}
#Cálculo simple de estadísticos descriptivos
min <- min(df_dax_nasdaq_dow$rdto_nasdaq, na.rm = TRUE)
q1 <- quantile(df_dax_nasdaq_dow$rdto_nasdaq, probs = 0.25, na.rm = TRUE)
media <- mean.default(df_dax_nasdaq_dow$rdto_nasdaq, na.rm = TRUE)
media_rec <- mean.default(df_dax_nasdaq_dow$rdto_nasdaq, trim = 0.025, na.rm = TRUE)
mediana <- median.default(df_dax_nasdaq_dow$rdto_nasdaq, na.rm = TRUE)
moda <- mfv(df_dax_nasdaq_dow$rdto_nasdaq)
var <- var(df_dax_nasdaq_dow$rdto_nasdaq, na.rm = TRUE)
desvest <- sd(df_dax_nasdaq_dow$rdto_nasdaq, na.rm = TRUE)
q3 <- quantile(df_dax_nasdaq_dow$rdto_nasdaq, probs = 0.75, na.rm = TRUE)
max <- max(df_dax_nasdaq_dow$rdto_nasdaq, na.rm = TRUE)
s <- skew(df_dax_nasdaq_dow$rdto_nasdaq)
c <- kurtosi(df_dax_nasdaq_dow$rdto_nasdaq)

#Valores de estadísticos como vector
descriptivos_rdto_nasdaq <- as.numeric(round(c(min, q1, media, media_rec, mediana, moda,
                          var, desvest, q3, max, s, c),5))

nombres_desc_rdto_nasdaq <- c("Mínimo", "Q1", "Media", "Media recortada", "Mediana", "Moda",
             "Varianza", "Desviación Estándar", "Q3", "Máximo", "Simetría", "Curtosis")

cuadro_eda_nasdaq <- as.data.frame(rbind(nombres_desc_rdto_nasdaq,descriptivos_rdto_nasdaq))
tabla_eda_nasdaq <- data.frame(t(cuadro_eda_nasdaq[-1]),row.names = NULL)
colnames(tabla_eda_nasdaq) <- c("Estadístico","rdto_nasdaq")
#tabla_eda_nasdaq


```


```{r}
# Generación de una tabla
kable(tabla_eda_nasdaq, align = c("l", "c")) %>% 
  kable_styling(full_width = F, bootstrap_options = "condensed") %>% 
  column_spec(1, width = "12em") %>% 
  column_spec(2, width = "10em") 
```




Se agregan las columnas correspondientes a los días de la semana.


```{r df-with-dow}

df_dax_nasdaq_dow <- as_tibble(df_dax_nasdaq_dow)
df_dax_nasdaq_dow <- mutate(df_dax_nasdaq_dow,
                            dia = weekdays(df_dax_nasdaq_dow$Fecha, abbreviate = FALSE)
)
df_dax_nasdaq_dow$dia[df_dax_nasdaq_dow$dia == "miércoles"] <- "miercoles"
head(df_dax_nasdaq_dow)
```




## Gráfico de la serie temporal de rendimientos del índice NASDAQ

```{r plot-nasdaq, echo=FALSE, fig.align='center', fig.width=5, fig.height=2} 
plot_nasdaq <- ggplot(df_dax_nasdaq_dow, aes(x = Fecha, y = rdto_nasdaq)) + 
  geom_line(color = "#00a2b1") +
  scale_y_continuous(expand = c(0,0), limits=c(min(df_dax_nasdaq_dow$rdto_nasdaq)*1.05, max(df_dax_nasdaq_dow$rdto_nasdaq)*1.05), label = comma) +
  labs(x = "Fecha") +
  ggtitle("Rendimientos NASDAQ por día") +
  theme(plot.title = element_text(hjust = 0.5))
ggplotly(plot_nasdaq)
```



Se ordenan los días de la semana.

```{r dax-orden-dias, echo=FALSE}
unique(df_dax_nasdaq_dow$dia)

df_dax_nasdaq_dow$dia = factor(df_dax_nasdaq_dow$dia, levels=c("lunes", "martes", "miercoles", "jueves", "viernes"))
levels(df_dax_nasdaq_dow$dia)
```


```{r boxplot-nasdaq, echo=FALSE, fig.align='center', fig.width=5, fig.height=2} 
boxplot_NASDAQ <- ggplot(df_dax_nasdaq_dow, aes(x = dia, y = rdto_nasdaq)) + 
  geom_boxplot(fill = "gray90", color = "gray40", outlier.colour = "#00a2b1") +
  scale_y_continuous(expand = c(0,0), limits=c(min(df_dax_nasdaq_dow$rdto_nasdaq)*1.15, max(df_dax_nasdaq_dow$rdto_nasdaq)*1.15), label = comma) +
  labs(title = "Rendimiento NASDAQ por día de la semana") +
  theme(axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.line.x = element_line(colour="gray20"))

boxplot_NASDAQ
```


Se generan valores binarios para los días de la semana.

```{r dow-binario}

df_dax_nasdaq_dow_dummies <- df_dax_nasdaq_dow %>% 
  mutate(var = 1) %>%                                   # Asigno un 1 en todas las filas de una columna
  spread(key = dia, value = var, fill = 0) %>%          # Creo las variables dummy 

# Reordeno y elimino lunes
dplyr::select(Fecha, DAX, rdto_dax, NASDAQ, rdto_nasdaq, martes, miercoles, jueves, viernes)  
head(df_dax_nasdaq_dow_dummies)
```





# Regresión mínimo cuadrática

Para el cálculo de la regresión se descartan las columnas Fecha, DAX y NASDAQ, quedando seleccionadas solamente las columnas de los días y la correspondiente al Rendimiento NASDAQ.


```{r analisis-nasdaq}
analysis_nasdaq <- df_dax_nasdaq_dow_dummies %>% dplyr::select(-Fecha,-DAX,-NASDAQ,-rdto_dax)
head(analysis_nasdaq)
```
Se calculan los valores de correlación entre los días de la semana y el rendimiento.

```{r}
cor(analysis_nasdaq)
```
Se observa una correlación negativa del día martes.

```{r}
library(GGally)
ggpairs(analysis_nasdaq, lower = list(continuous = "smooth"),
        diag = list(continuous = "barDiag"), axisLabels = "none")

```

Se genera la regresión lineal con el objetivo de explicar los valores de rdto_nasdaq en base a las variables
dicotómicas independientes correspondientes a los días de la semana.
En este caso se tiene la ecuación
$R_t = \beta_2 M_t + \beta_3 X_t + \beta_4 J_t + \beta_5 V_t + \epsilon_t$
Las variables $M_t$, $X_t$, $J_t$ y $V_t$ son las variables dummy asociadas a los días de la semana, tomando valor 1 si la observación corresponde a dicho día y 0 en otro caso.
Los coeficientes $\beta_2, \beta_3, \beta_4$ y $\beta_5$ representan los rendimientos medios de cada día. 
El término de error se representa mediante $\epsilon_t$. 
En este caso se han considerado 4 variables dummys correspondientes a los días martes, miércoles, jueves y viernes para tratar de explicar la variabilidad de los rendimientos tomando como base el día lunes.


Se configura y ejecuta el modelo.

```{r ajuste-modelo-dax}
full_model_nasdaq <- lm(rdto_nasdaq ~ martes + miercoles + jueves + viernes, data = analysis_nasdaq)
summary(full_model_nasdaq)
```
En base a los resultados del modelo se ve que los regresores externos son significativos para explicar la 
volatilidad de los rendimientos de NASDAQ. Se observa que el día martes tiene un poder explicativo algo menor (0.1%)
comparado con los días miércoles, jueves y viernes (0.2%).



#El modelo con las 4 variables dummys introducidas como predictores tiene un valor de $R_2$ bajo (0.003291). 
#El p-value del estadístico F es significativo (1.114e-08).

En los resultados se observa que todos los p-value de la prueba de hipótesis del estadístico t son significativos.

Si se aplica la estrategia de stepwise mixto para selección de los mejores predictores confirma que el modelo configurado es adecuado.


```{r}
step(object = full_model_nasdaq, direction = "both", trace = 1)
```


# REVISAR LA CONCLUSION
# En este caso parecen ser significativos todos.... sera que el efecto dia de la semana es el lunes?????



```{r}
confint(full_model_nasdaq)
```














# REGRESIÓN INCORPORANDO LA ECUACIÓN DE VARIANZA COMO UN MODELO GARCH(1,1)

Se generan los vectores de rendimiento para NASDAQ y los vectores de los días martes a viernes.

```{r}
n <- nrow(df_dax_nasdaq_dow_dummies)

rdto_nasdaq <- as.numeric(unlist(df_dax_nasdaq_dow_dummies[2:n,"rdto_nasdaq"]))

vardias_ma <- as.numeric(unlist(df_dax_nasdaq_dow_dummies[2:n,"martes"]))
vardias_mi <- as.numeric(unlist(df_dax_nasdaq_dow_dummies[2:n,"miercoles"]))
vardias_ju <- as.numeric(unlist(df_dax_nasdaq_dow_dummies[2:n,"jueves"]))
vardias_vi <- as.numeric(unlist(df_dax_nasdaq_dow_dummies[2:n,"viernes"]))

vardias <- cbind(vardias_ma,vardias_mi,vardias_ju,vardias_vi)
```


Se prueban distintos modelos para analizarlos, se analizan si los residuos son ruido blanco y se seleccionan los 
modelos mas adecuados.

## Modelo sGARCH(1,1) con External Regressors en modelo de media. Distribución std.

```{r}
spec_nasdaq1 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1), 
                        submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                        mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
                        distribution.model = "std")
garch_nasdaq1 <- ugarchfit(spec=spec_nasdaq1,data=rdto_nasdaq)

```


```{r echo=FALSE}

modelo_fit <- garch_nasdaq1
modelos <- c(modelo_fit)
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(modelo_fit, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb <- tibble(vmodel = modelo_fit@model[["modeldesc"]][["vmodel"]],
                    vp = modelo_fit@model[["modelinc"]][["alpha"]],
                    vq = modelo_fit@model[["modelinc"]][["beta"]],
                    vxreg = modelo_fit@model[["modelinc"]][["vxreg"]],
                    mp = modelo_fit@model[["modelinc"]][["ar"]],
                    mq = modelo_fit@model[["modelinc"]][["ma"]],
                    mxreg = modelo_fit@model[["modelinc"]][["mxreg"]],
                    dist = modelo_fit@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(modelo_fit)[1]
)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```


## Modelo sGARCH(1,1) con External Regressors en modelo de media y de varianza. Distribución std

```{r}
spec_nasdaq1_2er <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1), 
                        submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                        mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
                        distribution.model = "std")
garch_nasdaq1_2er <- ugarchfit(spec=spec_nasdaq1_2er,data=rdto_nasdaq)

```


```{r echo=FALSE}

modelo_fit <- garch_nasdaq1_2er
modelos <- c(modelos, modelo_fit)

#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq1_2er, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_2er <- tibble(vmodel = garch_nasdaq1_2er@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq1_2er@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq1_2er@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq1_2er@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq1_2er@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq1_2er@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq1_2er@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq1_2er@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq1_2er)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_2er)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:11, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo gjrGARCH(1,1) con External Regressors en modelo de media. Distribución std

```{r}
spec_nasdaq2 <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "std")
garch_nasdaq2 <- ugarchfit(spec=spec_nasdaq2,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq2, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq2 <- tibble(vmodel = garch_nasdaq2@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq2@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq2@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq2@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq2@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq2@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq2@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq2@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq2)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq2)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2")
# kable(t_comp_lb, row.names = TRUE)


# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo gjrGARCH(1,1) con External Regressors en modelo de media y de varianza. Distribución std

```{r}
spec_nasdaq2_2er <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors  = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "std")
garch_nasdaq2_2er <- ugarchfit(spec=spec_nasdaq2_2er,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq2_2er, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq2_2er <- tibble(vmodel = garch_nasdaq2_2er@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq2_2er@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq2_2er@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq2_2er@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq2_2er@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq2_2er@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq2_2er@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq2_2er@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq2_2er)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq2_2er)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo eGARCH(1,1) con External Regressors en modelo de media. Distribución std

```{r}
spec_nasdaq3 <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "std")
garch_nasdaq3 <- ugarchfit(spec=spec_nasdaq3,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq3, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq3 <- tibble(vmodel = garch_nasdaq3@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq3@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq3@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq3@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq3@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq3@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq3@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq3@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq3)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq3)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er","garch_nasdaq3")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)
```

## Modelo eGARCH(1,1) con External Regressors en modelo de media y de varianza. Distribución std

```{r}
spec_nasdaq3_2er <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "std")
garch_nasdaq3_2er <- ugarchfit(spec=spec_nasdaq3_2er,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq3_2er, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq3_2er <- tibble(vmodel = garch_nasdaq3_2er@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq3_2er@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq3_2er@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq3_2er@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq3_2er@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq3_2er@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq3_2er@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq3_2er@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq3_2er)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq3_2er)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er","garch_nasdaq3","garch_nasdaq3_2er")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo sGARCH(1,1) con External Regressors en modelo de media. Distribución norm

```{r}
spec_nasdaq4 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq4 <- ugarchfit(spec=spec_nasdaq4,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq4, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq4 <- tibble(vmodel = garch_nasdaq4@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq4@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq4@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq4@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq4@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq4@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq4@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq4@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq4)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq4)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er","garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)


```

## Modelo sGARCH(1,1) con External Regressors en modelo de media y de varianza. Distribución norm

```{r}
spec_nasdaq4_2er <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq4_2er <- ugarchfit(spec=spec_nasdaq4_2er,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq4_2er, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq4 <- tibble(vmodel = garch_nasdaq4_2er@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq4_2er@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq4_2er@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq4_2er@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq4_2er@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq4_2er@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq4_2er@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq4_2er@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq4_2er)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq4)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er","garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo gjrGARCH(1,1) con External Regressors en modelo de media. Distribución norm

```{r}
spec_nasdaq5 <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq5 <- ugarchfit(spec=spec_nasdaq5,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq5, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq5 <- tibble(vmodel = garch_nasdaq5@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq5@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq5@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq5@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq5@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq5@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq5@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq5@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq5)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq5)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er","garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
"garch_nasdaq5")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo gjrGARCH(1,1) con External Regressors en modelo de media y de varianza. Distribución norm

```{r}
spec_nasdaq5_2er <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq5_2er <- ugarchfit(spec=spec_nasdaq5_2er,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq5_2er, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq5_2er <- tibble(vmodel = garch_nasdaq5_2er@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq5_2er@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq5_2er@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq5_2er@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq5_2er@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq5_2er@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq5_2er@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq5_2er@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq5_2er)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq5_2er)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er","garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
"garch_nasdaq5","garch_nasdaq5_2er")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo eGARCH(1,1) con External Regressors en modelo de media. Distribución norm

```{r}
spec_nasdaq6 <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq6 <- ugarchfit(spec=spec_nasdaq6,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq6, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq6 <- tibble(vmodel = garch_nasdaq6@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq6@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq6@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq6@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq6@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq6@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq6@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq6@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq6)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq6)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er","garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
"garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo eGARCH(1,1) con External Regressors en modelo de media y de varianza. Distribución norm

```{r}
spec_nasdaq6_2er <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(0, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq6_2er <- ugarchfit(spec=spec_nasdaq6_2er,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo

#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq6_2er, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)


# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq6_2er <- tibble(vmodel = garch_nasdaq6_2er@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq6_2er@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq6_2er@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq6_2er@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq6_2er@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq6_2er@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq6_2er@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq6_2er@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq6_2er)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq6_2er)
rownames(t_comp_lb) <- c("garch_nasdaq1", "garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er","garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
"garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```


# Modelos GARCH(1,1) con ARMA(1,0)

## Modelo sGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media. Distribución std

```{r}
spec_nasdaq1_ar1 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1), 
                        submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                        mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
                        distribution.model = "std")
garch_nasdaq1_ar1 <- ugarchfit(spec=spec_nasdaq1_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq1_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq1_ar1 <- tibble(vmodel = garch_nasdaq1_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq1_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq1_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq1_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq1_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq1_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq1_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq1_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq1_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq1_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)
```






## Modelo sGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media y de varianza. Distribución std

```{r}
spec_nasdaq1_2er_ar1 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1), 
                        submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                        mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
                        distribution.model = "std")
garch_nasdaq1_2er_ar1 <- ugarchfit(spec=spec_nasdaq1_2er_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq1_2er_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq1_2er_ar1 <- tibble(vmodel = garch_nasdaq1_2er_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq1_2er_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq1_2er_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq1_2er_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq1_2er_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq1_2er_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq1_2er_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq1_2er_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq1_2er_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq1_2er_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo gjrGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media. Distribución std

```{r}
spec_nasdaq2_ar1 <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "std")
garch_nasdaq2_ar1 <- ugarchfit(spec=spec_nasdaq2_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq2_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq2_ar1 <- tibble(vmodel = garch_nasdaq2_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq2_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq2_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq2_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq2_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq2_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq2_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq2_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq2_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq2_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)
```

## Modelo gjrGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media y de varianza. Distribución std

```{r}
spec_nasdaq2_2er_ar1 <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors  = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "std")
garch_nasdaq2_2er_ar1 <- ugarchfit(spec=spec_nasdaq2_2er_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq2_2er_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq2_2er_ar1 <- tibble(vmodel = garch_nasdaq2_2er_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq2_2er_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq2_2er_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq2_2er_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq2_2er_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq2_2er_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq2_2er_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq2_2er_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq2_2er_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq2_2er_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)
```

## Modelo eGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media. Distribución std

```{r}
spec_nasdaq3_ar1 <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "std")
garch_nasdaq3_ar1 <- ugarchfit(spec=spec_nasdaq3_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq3_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq3_ar1 <- tibble(vmodel = garch_nasdaq3_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq3_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq3_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq3_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq3_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq3_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq3_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq3_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq3_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq3_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1",
                         "garch_nasdaq3_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo eGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media y de varianza. Distribución std

```{r}
spec_nasdaq3_2er_ar1 <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "std")
garch_nasdaq3_2er_ar1 <- ugarchfit(spec=spec_nasdaq3_2er_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq3_2er_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq3_2er_ar1 <- tibble(vmodel = garch_nasdaq3_2er_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq3_2er_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq3_2er_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq3_2er_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq3_2er_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq3_2er_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq3_2er_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq3_2er_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq3_2er_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq3_2er_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1",
                         "garch_nasdaq3_ar1","garch_nasdaq3_2er_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo sGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media. Distribución norm

```{r}
spec_nasdaq4_ar1 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq4_ar1 <- ugarchfit(spec=spec_nasdaq4_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq4_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq4_ar1 <- tibble(vmodel = garch_nasdaq4_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq4_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq4_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq4_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq4_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq4_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq4_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq4_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq4_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq4_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1",
                         "garch_nasdaq3_ar1","garch_nasdaq3_2er_ar1","garch_nasdaq4_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo sGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media y de varianza. Distribución norm

```{r}
spec_nasdaq4_2er_ar1 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq4_2er_ar1 <- ugarchfit(spec=spec_nasdaq4_2er_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq4_2er_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq4_2er_ar1 <- tibble(vmodel = garch_nasdaq4_2er_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq4_2er_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq4_2er_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq4_2er_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq4_2er_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq4_2er_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq4_2er_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq4_2er_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq4_2er_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq4_2er_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1",
                         "garch_nasdaq3_ar1","garch_nasdaq3_2er_ar1","garch_nasdaq4_ar1","garch_nasdaq4_2er_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo gjrGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media. Distribución norm

```{r}
spec_nasdaq5_ar1 <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq5_ar1 <- ugarchfit(spec=spec_nasdaq5_ar1,data=rdto_nasdaq)

```


```{r}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq5_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq5_ar1 <- tibble(vmodel = garch_nasdaq5_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq5_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq5_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq5_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq5_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq5_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq5_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq5_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq5_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq5_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1",
                         "garch_nasdaq3_ar1","garch_nasdaq3_2er_ar1","garch_nasdaq4_ar1","garch_nasdaq4_2er_ar1",
                         "garch_nasdaq5_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
# t_resumen_lb <- knitr::kable(t_comp_lb,
#                              digits = 6,
#                              caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                              kable_styling(font_size = 12)
# column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo gjrGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media y de varianza. Distribución norm

```{r}
spec_nasdaq5_2er_ar1 <- ugarchspec(variance.model = list(model = "gjrGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq5_2er_ar1 <- ugarchfit(spec=spec_nasdaq5_2er_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq5_2er_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq5_2er_ar1 <- tibble(vmodel = garch_nasdaq5_2er_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq5_2er_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq5_2er_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq5_2er_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq5_2er_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq5_2er_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq5_2er_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq5_2er_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq5_2er_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq5_2er_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1",
                         "garch_nasdaq3_ar1","garch_nasdaq3_2er_ar1","garch_nasdaq4_ar1","garch_nasdaq4_2er_ar1",
                         "garch_nasdaq5_ar1","garch_nasdaq5_2er_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo eGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media. Distribución norm

```{r }
spec_nasdaq6_ar1 <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = NULL, variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq6_ar1 <- ugarchfit(spec=spec_nasdaq6_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq6_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq6_ar1 <- tibble(vmodel = garch_nasdaq6_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq6_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq6_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq6_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq6_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq6_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq6_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq6_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq6_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq6_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1",
                         "garch_nasdaq3_ar1","garch_nasdaq3_2er_ar1","garch_nasdaq4_ar1","garch_nasdaq4_2er_ar1",
                         "garch_nasdaq5_ar1","garch_nasdaq5_2er_ar1","garch_nasdaq6_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
#t_resumen_lb <- knitr::kable(t_comp_lb,
#                             digits = 6,
#                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
#                             kable_styling(font_size = 12)
#column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```

## Modelo eGARCH(1,1) con ARMA(1,0) con External Regressors en modelo de media y de varianza. Distribución norm

```{r}
spec_nasdaq6_2er_ar1 <- ugarchspec(variance.model = list(model = "eGARCH", garchOrder = c(1, 1), 
                    submodel = NULL, external.regressors = vardias[,1:4], variance.targeting = FALSE), 
                    mean.model = list(armaOrder = c(1, 0),external.regressors = vardias[,1:4]),
               distribution.model = "norm")
garch_nasdaq6_2er_ar1 <- ugarchfit(spec=spec_nasdaq6_2er_ar1,data=rdto_nasdaq)

```


```{r echo=FALSE}
#Se realiza el test de Ljung-Box sobre los residuos del modelo
#Ljung-Box
resid.arch <- as.numeric(residuals(garch_nasdaq6_2er_ar1, standardize=TRUE))
lb_lag1 <- Box.test(resid.arch, lag=1, type="Ljung-Box", fitdf=0)
lb_lag2 <- Box.test(resid.arch, lag=2, type="Ljung-Box", fitdf=0)
lb_lag5 <- Box.test(resid.arch, lag=5, type="Ljung-Box", fitdf=0)

# creo un tibble con el resumen del modelo y los valores de Ljung-Box
t_comp_lb_nasdaq6_2er_ar1 <- tibble(vmodel = garch_nasdaq6_2er_ar1@model[["modeldesc"]][["vmodel"]],
                    vp = garch_nasdaq6_2er_ar1@model[["modelinc"]][["alpha"]],
                    vq = garch_nasdaq6_2er_ar1@model[["modelinc"]][["beta"]],
                    vxreg = garch_nasdaq6_2er_ar1@model[["modelinc"]][["vxreg"]],
                    mp = garch_nasdaq6_2er_ar1@model[["modelinc"]][["ar"]],
                    mq = garch_nasdaq6_2er_ar1@model[["modelinc"]][["ma"]],
                    mxreg = garch_nasdaq6_2er_ar1@model[["modelinc"]][["mxreg"]],
                    dist = garch_nasdaq6_2er_ar1@model[["modeldesc"]][["distribution"]],
                    lb1 = lb_lag1$p.value,
                    lb2 = lb_lag2$p.value,
                    lb5 = lb_lag5$p.value,
                    ic1 = infocriteria(garch_nasdaq6_2er_ar1)[1]
)

# agrego linea de resumen del modelo y muestro la tabla
t_comp_lb <- rbind(t_comp_lb,t_comp_lb_nasdaq6_2er_ar1)
rownames(t_comp_lb) <- c("garch_nasdaq1","garch_nasdaq1_2er","garch_nasdaq2","garch_nasdaq2_2er",
                         "garch_nasdaq3","garch_nasdaq3_2er","garch_nasdaq4","garch_nasdaq4_2er",
                         "garch_nasdaq5","garch_nasdaq5_2er","garch_nasdaq6","garch_nasdaq6_2er",
                         "garch_nasdaq1_ar1","garch_nasdaq1_2er_ar1","garch_nasdaq2_ar1","garch_nasdaq2_2er_ar1",
                         "garch_nasdaq3_ar1","garch_nasdaq3_2er_ar1","garch_nasdaq4_ar1","garch_nasdaq4_2er_ar1",
                         "garch_nasdaq5_ar1","garch_nasdaq5_2er_ar1","garch_nasdaq6_ar1","garch_nasdaq6_2er_ar1")
# kable(t_comp_lb, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
t_resumen_lb <- knitr::kable(t_comp_lb,
                             digits = 6,
                             caption = "Resumen del modelo y Ljung-Box test", booktabs = TRUE) %>%
                             kable_styling(font_size = 12)
column_spec(t_resumen_lb, 1:12, width = "2em")#, bold = TRUE, italic = TRUE)

```


```{r}
t_resumen_lb
```



```{r}
tabla_ljung_box <- as_tibble(t_comp_lb)
tabla <- tabla_ljung_box %>% filter(lb1 > 0.05, lb2 > 0.05)#, lb5 > 0.05)
tabla <- arrange(tabla, desc(ic1))                        

# tabla con valores de Ljung Box adecuados
t_resumen_lb <- knitr::kable(tabla,
                             digits = 6,
                             caption = "Modelos con valores adecuados del Ljung-Box test", booktabs = TRUE) %>%
                             kable_styling(font_size = 11)
column_spec(t_resumen_lb, 1:10, width = "7em")#, bold = TRUE, italic = TRUE)

```
# Significado de cada columna de la tabla

*vmodel*= modelo GARCH implementado.

*vp*= componente ARCH del modelo de la varianza.

*vq*= componente GARCH del modelo de la varianza.

*vxreg*= cantidad de regresores externos en el modelo de la varianza.

*mp*= componente AR del modelo de la media.

*mq*= componente MA del modelo de la media.

*mxreg*= cantidad de regresores externos en el modelo de la media.

*dist*= distribución que siguen los errores. 

*lb1*= valor del test de Ljung-Box para el rezago uno.

*lb2*= valor del test de Ljung-Box para el rezago dos.

*lb5*= valor del test de Ljung-Box para el rezago cinco.

*ic1*= valor de akaike del modelo.


# Análisis de los resultados
Para poder analizar los modelos y elegir el mejor, debemos observar los valores del test de Ljung-Box y el de los criterios de información.
En el caso del test de Ljung-Box buscamos un valor mayor a 0.05 que nos indique que los residuos del modelo son ruido blanco y no contienen información significativa. En la tabla se observan solo los modelos que cumplen con este filtro. Se muestran los valores del test para los rezagos uno, dos y cinco (lb1, lb2, lb5).
Respecto a los criterios de información, en la tabla se muestra el valor de akaike de los modelos (ic1). El mejor modelo es el modelo con menor valor de akaike, por ello la tabla se encuentra ordenada de forma descendiente de acuerdo a este valor.

Siguiendo estas indicaciones se puede observar que los dos mejores modelos son:

1_ eGARCH con GARCH(1,1), ARMA(1,0), distribucion std y ER en media y varianza (garch_nasdaq3_2er_ar1)

2_ eGARCH con GARCH(1,1), ARMA(1,0), distribucion std y ER solo en media (garch_nasdaq3_ar1)




Parámetros de los dos mejores modelos y sus valores de significancia:

```{r}
garch_nasdaq3_2er_ar1
garch_nasdaq3_ar1
```








### -
### Modificar la evaluación de los modelos luego de decidir con cuales nos quedamos...
### - 



# Evaluación de los 2 mejores modelos

## modelo garch_nasdaq2_2er_ar1
Tabla comparativa de los p-valores de los external regressors para los dos mejores modelos.

El primer modelo seleccionado es gjrGARCH(1,1) con ARMA(1,0) como modelo de media 
y distribución std. 
Se han incluido regresores externos como variables dummys tanto en media como en varianza.


```{r}
t_modelo_nasdaq2 <- print(round(garch_nasdaq2_2er_ar1@fit$matcoef,6), digits = 5)
kable(t_modelo_nasdaq2, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
t_modelo2 <- knitr::kable(t_modelo_nasdaq2,
                             digits = 6,
                             caption = "Modelo gjrGARCH(1,1) con ARMA(1,0)", booktabs = TRUE) %>%
                             kable_styling(font_size = 11)
column_spec(t_modelo2, 1:5, width = "1em")#, bold = TRUE, italic = TRUE)
```

De acuerdo a los p-valores de los regresores externos se observa que son significativos.
Si se analizan los valores estimados para cada día de la semana se ve que el día martes posee un valor explicativo del 0.01 
y los días miércoles, jueves y viernes de 0.02.
De acuerdo al valor de $alpha1$ el rendimiento es explicado en un 5.69% por la volatilidad del día anterior.
De acuerdo al valor de $beta1$ el rendimiento es explicado en un 89% por la varianza ajustada del día anterior.


## modelo garch_nasdaq3_2er_ar1

El siguiente modelo seleccionado es eGARCH(1,1) con ARMA(1,0) como modelo de media 
y distribución std.  
Se han incluido regresores externos como variables dummys tanto en media como en varianza.

```{r}

t_modelo_nasdaq3 <- print(round(garch_nasdaq3_2er_ar1@fit$matcoef,6), digits = 5)
kable(t_modelo_nasdaq3, row.names = TRUE)

# muestro la tabla resumen del modelo y valores de Ljung-Box test de los residuos del modelo
t_modelo3 <- knitr::kable(t_modelo_nasdaq3,
                             digits = 6,
                             caption = "Modelo eGARCH(1,1) con ARMA(1,0)", booktabs = TRUE) %>%
                             kable_styling(font_size = 11)
column_spec(t_modelo3, 1:5, width = "1em")#, bold = TRUE, italic = TRUE)
```

Para este modelo también se observa que los p-valores de los regresores son significativos 
y que el poder explicativo de los días de la semana es igual que en el modelo anterior.

De acuerdo al valor de $alpha1$ el rendimiento es explicado en un 6.99% por la volatilidad del día anterior.
De acuerdo al valor de $beta1$ el rendimiento es explicado en un 98.8% por la varianza ajustada del día anterior.


Por lo tanto se asume que el eGARCH(1,1) con ARMA(1,0) podría ser una alternativa para realizar pronósticos de los
rendimientos de NASDAQ.



# Comparativa de puntos (b) y (c)

Para el dataset NASDAQ se concluye que la significancia de las variables y los porcentajes dan muy similares entre la regresión mínimo cuadrática y los modelos GARCH.
Se considera conveniente incorporar los GARCH porque los coeficientes de $alpha1$ y $beta1$ dan significativos, y esto ademas permite ver el comportamiento de la varianza.

